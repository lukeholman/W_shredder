---
title: "Evolutionary models of Z-linked synthetic suppression gene drives"
author:
- Luke Holman*
- '*\textit{luke.holman@unimelb.edu.au} \vspace{5mm}'
bibliography: references.bib
output:
  pdf_document: default
  html_document: default
  word_document: default
fontsize: 12pt
header-includes: \usepackage{microtype} \usepackage{amsmath}
  \usepackage{booktabs} \usepackage{caption} \usepackage[labelfont=bf]{caption} \usepackage{titling}
  \pretitle{\begin{flushleft}\LARGE} \posttitle{\par\end{flushleft}\vskip 0.5em} \preauthor{\begin{flushleft}\large
  \lineskip 0.5em} \postauthor{\par\end{flushleft}} \predate{\begin{flushleft}\large}
  \postdate{\par\end{flushleft}} \usepackage{fancyhdr} \pagestyle{fancy} \fancyhead[LO,LE]{\textsl{\leftmark}}
  \rhead[]{Z-linked gene drives} \usepackage[noabbrev,capitalise]{cleveref} \usepackage{titlefoot}
  \usepackage{amssymb} \usepackage{rotating} \usepackage{lineno} \linenumbers
csl: the-american-naturalist.csl
abstract: My abstract text. 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
source("../code/table_1_code.r")
```

\maketitle\unmarkedfntext{*School of BioSciences, The University of Melbourne, Victoria, Australia.}

\textbf{Keywords: chromosomal shredders, meiotic drive, population suppression, schistosomiasis, selfish genes}.

<!-- \usepackage[all]{hypcap} -->




\newpage
# Introduction
Here is a reference [e.g. @Holman_2018], and here's a link to a figure (\autoref{example_plot}).

Here, we use stochastic individual-based simulations to identify parameters that determine whether a _Z_-linked meiotic drive element will spread and/or cause population suppression. The simulation is heavily inspired by proposals for various types of CRISPR-Cas9 _Z_-linked gene drivesdevised by Kevin Esvelt and colleagues (see [http://www.sculptingevolution.org/genedrives/current/schistosomiasis]()). The 'suppression drives' (i.e. gene drives intended to deplete or remove a population) proposed by Esvelt and colleagues are shown schematically in Figure 1. The drive would be active in _ZW_ females, and optionally also in _ZZ_ males.

For the female drive, one could add a genetic element (e.g. a casette of genes carrying _Cas9_ and appropriate guide RNAs, promoters, and a phenotypic marker) to the _Z_ chromosome, which targets and cuts repetitive DNA on the _W_ chromosome to create a '_W_-shredder', preventing or reducing the production of daughters by _ZW_ females. Esvelt and colleagues point out that the total number of offspring/sons produced by drive-carrying females depends on multiple factors, principally the timing of expression the gene drive (e.g. pre- or post-meiosis, or post-fertilisation), the strength of individual-level fitness costs to drive carriers (e.g. due to the expression of _Cas9_), and the ecology of the species (e.g. whether ova or offspring be easily replaced). They argue that in some cases, drive-carrying females might produce as many (or almost as many) offspring as a wild-type female, only with a male-biased offspring sex ratio (Figure 1, 1A). Alternatively, drive-carrying females might produce half (or less than half) the number of offspring, for example because the drive works by destroying all ova or offspring that inherit a _W_ chromosome, and females cannot compensate by producing more. Lastly, Esvelt et al. also proposed a _Z_-linked genetic element that causes carrier females to die or become sterile; such a "suicide gene" could presumably only spread if it had a transmission advantage in males (below).

If the _Z_-linked element also caused gene drive in males, it would probably spread through the population faster and be more likely to result in extinction. Male gene drive could be accomplished using 'standard' CRISPR-Cas9 gene conversion (REF), whereby the gene drive _Z_ converts the non-driving _Z_ in heterozygotes using homiong endonuclease activity followed by DNA repair, leading heterozygous males to prouce almost entirely drive-carrying sperm and offspring. Our simulation was designed to accommodate all of these possibilities.

Impressed by the promise of these ideas to control _ZW_ species, we sought to test which propoerties of the gene drive and the ecology of the target species are most important to determining the likelihood and speed with which the gene drive causes extinction. For example, the gene drive will presumably spread faster if it can effect drive in males as well as females, but perhaps a female-only gene drive (which might often be easier to create) would be adequate. Also, since the population will become more male-biased as the gene drive invades, there will be complex eco-evo feedback (REF) that might affect the evolutionary outcome. For example, the altered sex ratio might intensify the fitness advantage accruing to any resistant _W_ chromosomes or autosomal modifiers that prevent _W_-shredding, relative to that observed in earlier models dealing with autosome-linked gene drives (REF). Moreover, the change in sex ratio could affect the demographics of the population if males and females differ in their contribution to density-dependent population growth (KOKKO), or their migration rates (Xiang-Yi?). Also, previous theoretical work has warned that gene drives might sometime fail because of nonhomologous end joining (NHEJ), a phenomenon where a gene drive based on gene conversion creates a drive-resistant, non-driving allele instead of the intended effect (i.e. copying itself over to the homologous chromosome) [REFS: Unckless refs, (Gantz and Bier 2015; Gantz et al. 2015; Hammond et al. 2016; Wang et al. 2016)]. It is not clear _a priori_ whether the creation of resistant _Z_-linked alleles by NHEJ is a significant problem for a _Z_-linked gene drive, because it would only hinder gene conversion in _ZZ_ males, which is effectively a 'bonus' to the W-shredding that occurs in _ZW_ females.



```{r xtable, results="asis", fig.cap="Zfgzf"}
print_table1()
```



# Methods

## Overview

We model a finite population of dioecious diploids with _ZW_ sex determination, living in $j$ discrete habitat patches which are arranged linearly in a ring (preventing 'edge effects'). The model considers the demography and evolution of a population into which $n_{release}$ males carrying the _Z_-linked gene drive are released. The drive allele is capable of gene drive in females (e.g. through _W_-shredding) and optionally also gene drive in males (e.g. via gene consersion). The life cycle is simple and consists of discrete generations, each composed of the following phases: birth, dispersal between patches, breeding with patches, and death of the parental generation. The species has 3 loci with 2 or 3 alleles each, which can show Mendelian or non-Mendelian inheritance depending on the presence of the _Z_-linked drive allele and the assumptions of the model. The equilibrium population size was around 10,000 in all simulations prior to the release of the gene drive, symbolising a large population of pests while also keeping the computation time tractable. The model is a stochastic individual-based simulation written in R 3.4.0 (REFERENCE) and run on the `Spartan` high performance computing system at the University of Melbourne. An accompanying website presents the scripts (with annotations) used to run the model and generate the figures (link). 


## Loci and alleles

Each male individual in the simulation carries a single _Z_-linked locus and two autosomal loci, each with two alleles. Each female carries a single allele at the _Z_-linked locus plus a _W_ chromosome, as well as two alleles at both of the autosomal loci.

There are three possible _Z_-linked alleles: a wild-type allele (denoted _Z+_) which is vulnerable to gene drive; a gene drive allele (_Z\*_), and a resistant allele (_Zr_) which is immune to gene drive. Similarly, there are two possible types of _W_ chromosomes: a wild-type _W_ chromosome (_W+_) that is vulnerable to gene drive by the _Z\*_ allele, and a resistant _W_ chromosome (_Wr_) that is immune to gene drive.

The two autosomal loci are denoted _A/a_ and _B/b_, and control immunity to _W_-shredding and gene conversion respectively. _A/a_ and _B/b_ are 'trans-acting' resistance loci, since they are at a different locus (indeed, a different chromosome) to the gene drive allele, in contrast to the 'cis-acting' resistance conferred by the _Zr_ and _Wr_ alleles (REFERENCE). The _A/a_ locus carries alleles _a_ and _A_, where the _A_ allele is dominant and confers immunity to _Z_-linked gene drive (e.g. _W_-shredding) in females. The _B/b_ autosomal locus carries alleles _b_ and _B_, where _B_ is dominant and confers immunity to _Z_-linked gene drive (e.g. gene conversion) in males. 


## Calculating female and male fitness

We assume that wild-type individuals (i.e. lacking any gene drive or resistance alleles) have a fitness of 1, while other genotypes potentially have lower fitness. The fecundity of females carrying the gene drive is reduced by a factor $1 - C_f$, where a small $C_f$ implies minimal costs (e.g. because the _Z_-shredding occurs early enough that lost ova/offspring can be replaced), $C_f = 0.5$ could represent the case where the female's daughters all die and are not replaced, and $C_f = 1$ means that gene drive females are completely sterile (which is useful for modelling a female-sterilising, _Z_-linked gene drive as opposed to a _W_-shredder). Similarly, the fitness of males carrying the gene drive is reduced by a factor $1 - C_m$. Male fitness is used to calculate mating success (see below). Furthermore, the resistant chromosomes _Wr_ and _Zr_ are assumed to reduce fitness by a factor $1 - C_w$ and $1 - C_z$ respectively. All costs are multiplicative; for example, a _Z\*Zr_ male would have fitness $(1 - C_m)(1 - C_z)$. Additionally, all costs are dominant, in the sense that having one drive or resistance allele is equally costly as having two.

AUTOSOMES?


## Gamete production and gene drive

We assume that the _A/a_ and _B/b_ loci segregate independently during meiosis, and they display standard Mendelian inheritance. Inheritance of the sex chromosomes is also Mendelian, except for certain genotypes carrying one copy of the _Z\*_ gene drive allele. 

Firstly, females with the genotype _Z\*W+aaBB_, _Z\*W+aaBb_, or _Z\*W+aabb_ produce a fraction $\frac{1}{2}(1 + p_{shred})$ of _Z_-bearing gametes and $\frac{1}{2}(1 - p_{shred})$ _W_-bearing gametes. Therefore, these three female genotypes produce more than 50% male offspring if $p_{shred} > 0$, due to the shortage of _W_ chromosomes in their gametes. In contrast, the gamete frequencies of _Z\*Wr females_, or of females carrying at least one _A_ allele, conform to the standard Mendelian expectations.

Secondly, males with the genotypes _Z\*Z+AAbb_, _Z\*Z+Aabb_, or _Z\*Z+aabb_ produce a fraction $\frac{1}{2}(1 + p_{conv} - p_{conv} p_{nhej})$ of gametes carrying the _Z\*_ allele, $\frac{1}{2}(1 - p_{conv})$ gametes carrying the _Z+_ allele, and $\frac{1}{2}(p_{conv} p_{nhej}))$ gametes carrying the _Zr_ allele. The parameter $p_{conv}$ represents gene conversion, and when $p_{conv} > 0$, the _Z\*_ allele is over-represented in the gametes of these three male genotypes. The parameter $p_{nhej}$ represents 'non-homologous end joining', in which an endonuclease-based gene drive fails to copy itself to the homologous chromosome, and instead deletes its target site, thereby creating a resistant allele (REFERENCE). As before, the gamete frequencies of _Z\*Zr_ males, or of males carrying at least one _B_ allele, conform to the standard Mendelian expectations.


## Calculating female fecundity
To begin the breeding phase of the lifecycle, we first determine the number of offspring produced by each female in the population. We first calculate the expected fecundity of each female, which is affected by three factors: the female's genotype, the density of males and females in the local patch and/or the full population, and some global parameters in the model. 

Specifically, the expected fecundity of female $i$ ($F_i$) is calculated as

$$F_i = (1 + w_i r(1 - (D_i / K) ^ c))$$

where $w_i$ is the relative fitness of female $i$ (possible range: 0 to 1, where 1 is the fitness of the wild type _Z+W+aabb_ females), $D_i$ is the 'density' experienced by female $i$, $K$ is the carrying capacity, and $r$ and $c$ are constants that scale the maximum possible fecundity and the shape of density-dependence, respectively. Thus, we assume that offspring production is density-dependent, and follows the Richards model (REFERENCE).

To ensure that the simulation captures various possible types of life history and ecology (see Introduction), we calculate the density $D_i$ in various ways across different simulation runs. First, we define the 'global density' $d_g$, which is experienced equally by every female in every patch, as 

$$d_g = \sum_{i=1}^{N_f} w_i + \delta N_m$$	

where $N_f$ and $N_m$ is the number of females and males across all patches, the first term is the sum of the fitnesses of all these females, and $\delta$ is a constant (range: $0-\infty$) that scales the effect of each male on $d_g$, relative to a female with fitness $w_i = 1$. This formulation means that females with high relative fitness (i.e. fecundity) have a stronger effect on the global density than do low-fitness females. We also assume that each male contributes a fixed amount to the global density, irrespective of his genotype/fitness (male fitness is only used to determine male mating success; see below). The parameter $\delta$ represents sex differences in ecological niche use and behaviours that affect female fecundity. For example, we might expect $\delta<1$ in species where males and females utilise very different environmental niches, or $\delta>1$ in species with strong inter-locus sexual conflict. 

Second, we define the 'local density' $d_j$, which is experienced by every female in patch $j$, as 

$$d_j = \sum_{i=1}^{n_{f,j}} w_i + \delta n_{m,j}$$	

where $n_{f,j}$ and $n_{m,j}$ are the numbers of females and males in patch $j$. As before, this formulation means that $d_j$ depends on the fitnesses of the females in the patch, as well as the number of males (scaled by the constant $\delta$).

Finally, the overall density experienced by female $i$ in patch $j$ ($D_i$) is a composite of the global and local densities given by $D_i = \psi d_g + (1 - \psi)d_j$. The parameter $\psi$ scales the importance of global and local density to female fecundity. When $\psi = 0$, only local density matters and selection on females is entirely "soft", while when $\psi = 1$ only global density matters and selection on females is completely "hard" (REFERENCE). Intermediate values of $\psi$ produce a mixture of hard and soft selection on females, and the growth rate of population depends on density at both scales.

Once we have calculated the expected fecundity of each female ($F_i$), we generate the realised fecundity of the female by randomly sampling from a Poisson distribution with $\lambda = F_i$ (allowing for stochastic variation in fecundity between females with equal $F_i$). If the resulting number of offspring exceeds the global carrying capacity $K$, we randomly cull the offspring until $K$ are left. 


## Competition between males

After determining how many offspring each female produces, we determine the fathers of each of these offspring. We assume that all breeding occurs within patches, such that males only compete for mating/fertilisation with males from the same patch (i.e. selection on males is always "soft"; REFERENCE). If the patch contains $k$ different male genotypes and there are $n_1, n_2, ... n_k$ males of each genotype, the probability that a male of genotype $k$ is the father of any given offspring is 

$$p_j = \frac{n_{k}w_k}{\sum_{i=1}^{k}n_{i}w_i}$$

such that relatively common and/or high-fitness male genotypes are more likely to sire offspring. This formulation means that we assume that both sexes potentially reproduce with multiple different partners.

## Reproduction, mutation and dispersal

After picking the parents, we randomly generate each offspring's genotype based on the gamete (and thus zygote) frequencies that are expected from the parental genotypes. Offspring are born in the same patch as their parents, and the parental generation is replaced by the offspring generation (i.e. we assume discrete, non-overlapping generations). 

When an offspring is created, each _Z+_ allele it carries has a chance $\mu_Z$ to mutate to a _Zr_ allele, and _vice versa_ (i.e. mutation in both directions is equally probable). Similarly, each _W+_ allele has a chance $\mu_W$ to mutate to a _Wr_ allele, and _vice versa_. 

Female and male offspring disperse to another patch with probabilities $x_f$ and $x_m$ respectively. We model two types of dispersal, in separate simulations: local dispersal, in which offspring move to one of the two neighbouring patches with equal probability (recalling that the patches are arranged linearly in a ring), or global dispersal, in which dispersing offspring can land in any of the other patches.


## Running the simulation

We first initialised a population of 10,000 individuals (i.e. the carrying capacity, $K$) with low or zero frequencies of _Zr_, _Wr_, _A_ and _B_ alleles, higher frequencies of the wild type _Z+_, _W+_, _a_, and _b_ alleles, and zero _Z\*_ gene drive alleles. We then iterated the population for 50 generations of burn-in, to allow the population to approach demographic and genotypic equilibrium. We then introduced $n_{release}$ males with the genotype _Z\*Z\*aabb_, which represents the release into the wild of a laboratory-reared strain homozygous for the driving _Z_ and for autosomal factors conferring susceptibility to drive. Males are released after density-dependent regulation of female fecundity, but before picking fathers for the offspring. In some simulations, all the _Z\*Z\*aabb_ males were released in a single patch, while in others the $n_{release}$ males were randomly and evenly divided across all $k$ patches. We continued to cycle through the lifecycle (birth, migration, breeding, death) until either A) the driving _Z\*_ allele went extinct, B) the population went extinct, C) the _Wr_ chromosome went to fixation (making population suppression impossible), D) the _Z\*_ allele fixed, but failed to cause population extinction, or E) 900 generations had elapsed. We recorded which of these five outcomes occurred, as well as the allele frequencies, population size, and sex ratio at each generation. 



# Results

  - Note that when females hardly migrate, the Wr is slow to spread across patches. It only has a good invasion probability if Z* is present, otherwise it's neutral or costly

<!-- ![My figure legend. My figure legend. My figure legend. My figure legend. My figure legend. My figure legend. My figure legend. \label{example_plot}](../figures/example_fig_123456.pdf) -->

# Discussion


# Acknowledgements
So long, and thanks for all the fish!

# References
<div id="refs"></div>

\newpage
# Supporting information
